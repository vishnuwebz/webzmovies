{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="admin-container">
    {% include 'admin_sidebar.html' %}

    <div class="admin-content">
        <div class="admin-header glass">
            <h2>User Management</h2>
            <div class="admin-search">
                <form method="GET" action="{% url 'movies:admin_users' %}">
                    <input type="text" name="search" placeholder="Search users..." value="{{ search_query }}">
                    <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
                </form>
                <a href="{% url 'movies:admin_user_add' %}" class="btn btn-primary" style="margin-left: 1rem;" target="_blank">
                    <i class="fas fa-user-plus"></i> Add User
                </a>
            </div>
        </div>

        <div class="stats-grid" style="margin-bottom: 2rem;">
            <div class="stat-card glass">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ users.paginator.count }}</h3>
                    <p>Total Users</p>
                </div>
            </div>
            
            <div class="stat-card glass">
                <div class="stat-icon" style="background: rgba(34, 197, 94, 0.2);">
                    <i class="fas fa-user-check" style="color: #22c55e;"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ active_users_count }}</h3>
                    <p>Active Users</p>
                </div>
            </div>
            
            <div class="stat-card glass">
                <div class="stat-icon" style="background: rgba(139, 92, 246, 0.2);">
                    <i class="fas fa-crown" style="color: #8b5cf6;"></i>
                </div>
                <div class="stat-content">
                    <h3>{{ staff_users_count }}</h3>
                    <p>Staff Members</p>
                </div>
            </div>
        </div>

        <div class="table-container glass">
            <table>
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Name</th>
                        <th>Joined</th>
                        <th>Status</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">
                                    {{ user.username|first|upper }}
                                </div>
                                <div class="user-details">
                                    <strong>{{ user.username }}</strong>
                                    <small>ID: {{ user.id }}</small>
                                </div>
                            </div>
                        </td>
                        <td>{{ user.email|default:"-" }}</td>
                        <td>
                            {% if user.first_name or user.last_name %}
                                {{ user.first_name }} {{ user.last_name }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ user.date_joined|date:"M d, Y" }}</td>
                        <td>
                            {% if user.is_active %}
                                <span class="status status-active">Active</span>
                            {% else %}
                                <span class="status status-inactive">Inactive</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.is_superuser %}
                                <span class="role-badge role-superuser">Superuser</span>
                            {% elif user.is_staff %}
                                <span class="role-badge role-staff">Staff</span>
                            {% else %}
                                <span class="role-badge role-user">User</span>
                            {% endif %}
                        </td>
                        <td class="action-cell">
                            <a href="/admin/auth/user/{{ user.id }}/change/" class="action-btn btn-edit" target="_blank">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="/admin/auth/user/{{ user.id }}/delete/" class="action-btn btn-delete" target="_blank">
                                <i class="fas fa-trash"></i>
                            </a>
                            <a href="{% url 'profile' %}?user_id={{ user.id }}" class="action-btn btn-view" target="_blank">
                                <i class="fas fa-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="no-data">
                            {% if search_query %}
                            No users found matching "{{ search_query }}"
                            {% else %}
                            No users found.
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if users.has_other_pages %}
        <div class="pagination glass">
            <span class="step-links">
                {% if users.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">&laquo; First</a>
                    <a href="?page={{ users.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Previous</a>
                {% endif %}

                <span class="current">
                    Page {{ users.number }} of {{ users.paginator.num_pages }}
                </span>

                {% if users.has_next %}
                    <a href="?page={{ users.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Next</a>
                    <a href="?page={{ users.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">Last &raquo;</a>
                {% endif %}
            </span>
        </div>
        {% endif %}
    </div>
</div>
{% block footer %}

{% endblock %}
<style>
    .user-info {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--accent-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .user-details {
        display: flex;
        flex-direction: column;
    }

    .user-details small {
        color: var(--text-muted);
        font-size: 0.8rem;
    }

    .role-badge {
        padding: 0.3rem 0.6rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
        display: inline-block;
    }

    .role-superuser {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }

    .role-staff {
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
    }

    .role-user {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
    }

    .status-inactive {
        background: rgba(107, 114, 128, 0.2);
        color: #6b7280;
    }

    .action-cell {
        display: flex;
        gap: 0.5rem;
    }

    .action-btn {
        padding: 0.5rem;
        border-radius: 6px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
    }

    .btn-edit {
        background: rgba(59, 130, 246, 0.2);
        color: #3b82f6;
        border: none;
    }

    .btn-delete {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
        border: none;
    }

    .btn-view {
        background: rgba(139, 92, 246, 0.2);
        color: #8b5cf6;
        border: none;
    }

    .no-data {
        text-align: center;
        padding: 2rem;
        color: var(--text-muted);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .user-info {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .action-cell {
            flex-direction: column;
            gap: 0.3rem;
        }
        
        table {
            font-size: 0.9rem;
        }
        
        th, td {
            padding: 0.8rem;
        }
    }
</style>
{% endblock %}